<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Flip 7 Online - INSA</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #game-board { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 800px; }
        .player-card { border: 2px solid #eee; border-radius: 10px; padding: 15px; margin: 10px 0; transition: 0.3s; }
        .player-card.active { border-color: #007bff; background: #f0f7ff; }
        .hand { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .card { background: #fff; border: 2px solid #333; border-radius: 6px; padding: 8px 12px; font-weight: bold; min-width: 30px; text-align: center; box-shadow: 2px 2px 0px #333; }
        .card.special { border-color: #e67e22; color: #e67e22; }
        #controls, #selection-cible { display: none; margin-top: 20px; padding: 15px; background: #f9f9f9; border: 1px dashed #ccc; text-align: center; }
        .btn { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; color: white; transition: 0.2s; }
        .btn-blue { background: #007bff; }
        .btn-red { background: #dc3545; }
        #statut { font-weight: bold; color: #007bff; margin: 10px 0; }
        #logs { height: 80px; overflow-y: auto; background: #2c3e50; color: #ecf0f1; padding: 10px; border-radius: 5px; font-size: 13px; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="game-board">
        <h1>Flip 7 Online üÉè</h1>
        <div id="statut">Connexion en cours...</div>

        <div id="host-zone" style="display: none;">
            <p>üëë Mode H√¥te activ√©</p>
            <button class="btn btn-blue" onclick="lancer()">D√âMARRER LA PARTIE</button>
        </div>

        <ul id="player-list"></ul>
        <hr>
        
        <div id="plateau"></div>

        <div id="controls">
            <p>√Ä vous de jouer :</p>
            <button class="btn btn-blue" onclick="monClient.sendAction('o')">Piocher</button>
            <button class="btn btn-red" onclick="monClient.sendAction('n')">S'arr√™ter</button>
        </div>

        <div id="selection-cible">
            <h3 id="nom-action"></h3>
            <div id="liste-cibles"></div>
        </div>

    </div>

    <script src="client.js"></script>
    <script>
        const nomJoueur = prompt("Votre nom :") || "Joueur_" + Math.floor(Math.random()*100);
        const monClient = new Flip7Client(nomJoueur);
        monClient.connect();

        function majPlateau(joueurs) {
            const plateau = document.getElementById('plateau');
            plateau.innerHTML = "";
            
            joueurs.forEach(j => { // boucle sur chaque joueur --> cr√©ation du bloc visuel
                const div = document.createElement('div');
                div.className = `player-card ${j.enJeu ? 'active' : ''}`;
                
                // Construction du HTML de la main
                const cartesHtml = j.main.map(c => {
                    let style = "background: #fff; color: #333;"; 
                    if (c.utilisee) { // carte d√©j√† jou√©e alors elle devient grise et transparente
                        style = "background: #ccc; color: #777; border-color: #999; opacity: 0.6;";
                    } else if (c.isAction) { // si carte action alors la bordure est orange
                        style = "border-color: #e67e22; color: #e67e22; background: #fff;";
                    }
                    return `<div class="card" style="${style}">${c.label}</div>`;
                }).join('');
                // pour l'affichage des scores ont a celui de la manche en bleu et le total en vert + ic√¥nes d'etat (bouclier ou √©liminer)
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; position: relative;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <strong>${j.nom}</strong>
                            ${j.protege ? '<span title="Seconde Chance active" style="font-size: 1.2em;">üõ°Ô∏è</span>' : ''}
                        </div>
                        <span>
                            Manche: <b style="color:blue">${j.scoreManche}</b> |
                            Total: <b style="color:green">${j.scoreGlobal}</b>
                        </span>
                    </div>
                    ${j.elimine ? '<p style="color:red; font-weight:bold; margin: 5px 0;">‚ùå √âLIMIN√â</p>' : ''}
                    <div class="hand" style="margin-top: 10px;">${cartesHtml}</div>
                `;
                plateau.appendChild(div);
            });
        }

        function afficherSelectionCible(action, cibles) { // elle cr√©e dynamiquement les boutons pour chaque adversaire quand il faut utiliser une carte action
            const container = document.getElementById('selection-cible');
            container.style.display = 'block';
            document.getElementById('nom-action').innerText = "Cible pour : " + action;
            const liste = document.getElementById('liste-cibles');
            liste.innerHTML = "";
            cibles.forEach(c => {
                const b = document.createElement('button');
                b.className = "btn btn-blue";
                b.style.margin = "5px";
                b.innerText = c.nom;
                b.onclick = () => { // envoie la cible choisie au serveur et cache la s√©lection
                    monClient.socket.send(JSON.stringify({ type: 'CIBLE_CHOISIE', cibleId: c.id }));
                    container.style.display = 'none';
                };
                liste.appendChild(b);
            });
        }

        function lancer() {
            monClient.sendStartGame();
            document.getElementById('host-zone').style.display = 'none';
        }

    </script>
</body>
</html>